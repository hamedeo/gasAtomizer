#!/bin/bash

#---------------------------################################################----------------------------------#
#---------------------------################################################----------------------------------#


#---------------------------################################################----------------------------------#
#------------------##################------------------------------##################-------------------------#
#---------------########------------------  FOAM ALL RUN  ----------------------########----------------------#
#------------------##################------------------------------##################-------------------------#
#---------------------------################################################----------------------------------#
#                                                                                                             |
#     Medeo to run multiple OpenFoam cases automatically. Hope this will help openScience     ⣀⣀              |
#⠀⠀⠀ Copyright (C) <2023>  <meDeo>                                                          ⣴⠾⡍⣧⣹⡆            |
#    ⠀⠀⠀⠀                                                                                ⠀⣠⡿⢁⡴⠟⠋⣷⣽⠀           |
#    This program is free software: you can redistribute it and/or modify⠀⠀⠀⠀⠀           ⠀⣿⢵⠷⠄⠀⠀⣿⡸⠀  ⠀⠀⠀⠀⠀    |
#    it under the terms of the GNU General Public License as published by  ⠀⠀⠀⠀          ⠀⢿⠘⣎⠀⢀⡼⢯⠃       ⠀⠀⠀⠀⠀|
#    the Free Software Foundation, either version 3 of the License, or  ⠀⠀⠀⠀⠀⠀⠀    ⠀ ⠀   ⠘⣧⣽⠧⣊⡾⠋⠀⠀⠀           |
#⠀⠀ ⠀(at your option) any later version.                                      ⠀⠀          ⢸⡿⠋⠉ ⠀⠀⠀⠀⠀          |
#    ⠀⠀                                                               ⠀⠀⠀⠀⠀⠀⠀   ⣀⣠⣤⣤ ⣀⣀⣀⣀⡠⠾⢅⣀⡀     ⠀⠀⠀⠀⠀⠀⠀    |
#    This program is distributed in the hope that it will be useful,⠀⠀⠀⠀⠀      ⢸⠋⠀⠀ ⠀⠈⠉⠉⠁⠀⡩⠬⢼⡍⠉⠛⢒⠶⠶⠦⠄         |
#    but WITHOUT ANY WARRANTY; without even the implied warranty of           ⢸⠀⠠⠀⠀⢀⠀⠀⢀⠔⢁⡔⠁  ⢈⡧⢽⠀⢠⡄ ⡈   ⠀⠀ ⠀  |
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            ⢸⠀⢸⣸⠀⠀⣰⣖⠋⣠⠋⠀ ⠀⠀⣸⡇⠈⠃⢀⣳⠀⡅         |
#                                                                             ⢻⢀⠀⠹⢀⣴⠃⠀⠀⠀⠀⣰⠿⠀⠀⢀⣤⢸⡇⡇            |
#    GNU General Public License for more details.                              ⡇⠀⠘⣿⣠⢴⠞⠁⠀⠀⠀⠀⡼⠁⠆⡤⠀⠀⢈⣶⢁⠃         |
#    You should have received a copy of the GNU General Public License         ⢱⡀⡄⠘⢿⠃⠀ ⢀⡞⠁⠀⡆⢀⣠⢺⡿⣗⣸            |
#    along with this program.  If not, see <https://www.gnu.org/licenses/>   ⠀⢸⣿⢧⠀⠘ ⠀⠀⣰⠏⠀⠀⠈⠩⠿⠵⠊⢀⡠⡜⠀           |
#                                                                              ⠈⠧⠬⠷⠤⠤⠤⠼⠾⠥⠤⠤⠤⠤⠤⠤⠤⠴⠥⠶⠇⠀         |
#---------------------------###############################################-----------------------------------#
#---------------------------################╭━━━╮##########################-----------------------------------#
#---------------------------################┃╭━╮┃##########################-----------------------------------#
#---------------------------################┃┃╱┃┣━━┳━━╮####################-----------------------------------#
#---------------------------################┃┃╱┃┃━━┫╭╮┃####################-----------------------------------#
#---------------------------################┃╰━╯┃━━┫╰╯┃####################-----------------------------------#
#---------------------------################╰━━━┻━━┻━━╯####################-----------------------------------#
#---------------------------###############################################-----------------------------------#


#######################################################################
#########   Activate the screen blanking prevention
#######################################################################

#xset s off
#xset -dpms
#xset s noblank
#######################################################################
#######################################################################
#######################################################################


wait_time=1	# Define variables

#######################################################################
#########   Prompt the user to confirm shutdown
#######################################################################

read -p "Do you want to shut down the system after execution? (y/n) " confirm

if [[ $confirm == "y" ]]; then
    # Prompt the user to enter the wait time
    read -p "Enter the time to wait before shutting down (in minutes): " wait_time
    echo "System will shut down in $wait_time minutes after execution."
fi
#######################################################################
#######################################################################
#######################################################################



#######################################################################
####### Case Execution
#######################################################################
start_time=$(date +%s.%N)

# Original directory
orDir=$(pwd)


###### Directory List  ###########
# List of directories to execute commands in
directories=$(find ./ -maxdepth 1 \( -name "secondaryBreakupBenz-*" \))
echo "$directories"
sleep 10
# Prompt the user to confirm shutdown
read -p "Do you confirm the directory list? (y/n) " dirlistconfirm

if [[ $dirlistconfirm != "y" ]]; then
    echo "Please check the code again"
    sleep 2
    exit 1
else
    echo "Great"
    sleep 1
fi
##################################


# Loop through each directory and execute commands
for dir in $directories
do
    cat << EoF
        $(echo -e "\e[1;31m/\/\//\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/
        \/\/\/\/\/\/\/\/      Executing case in $dir
        \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\e[0m")
EoF

    cd "$dir"

    ##################################
    # Run the Case in the Case Folder
    source run
    ##################################

    echo "Foam $dir done"

    if command -v beep >/dev/null 2>&1; then
	 # Beep superMario as a case complition
	beep -n -f 146 -l 20 -D 0 -n -f 369 -l 20 -D 0 -n -f 659 -l 20 -D 47 -n -f 146 -l 20 -D 0 -n -f 369 -l 20 -D 0 -n -f 659 -l 20 -D 189 -n -f 146 -l 20 -D 0 -n -f 369 -l 20 -D 0 -n -f 659 -l 20 -D 190 -n -f 146 -l 20 -D 0 -n -f 369 -l 20 -D 0 -n -f 523 -l 20 -D 47 -n -f 146 -l 20 -D 0 -n -f 369 -l 20 -D 0 -n -f 659 -l 20 -D 190 -n -f 391 -l 20 -D 0 -n -f 493 -l 20 -D 0 -n -f 783 -l 20 -D 475 -n -f 195 -l 20 -D 0 -n -f 391 -l 20 -n -f 195 -l 20 -D 0 -n -f 391 -l 20 -D 473
    else
	echo ""
    fi

    # Back to original directory
    cd $orDir
done

end_time=$(date +%s.%N)
total_time=$(echo "$end_time - $start_time" | bc)
echo "Whole execution time $total_time seconds"

echo "All Foam done"
    cat << EoF
        $(echo -e "\e[1;37;41m  /\//\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\e[0m
        \e[1;37;41m /\/\/\/\/\/\/\/      FINISHED      /\/\/\/\/\/\/\/\/\/\/\/\/\/\/ \e[0m
        \e[1;37;41m/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/  \e[0m")
EoF

if command -v beep >/dev/null 2>&1; then
	# Play Victory as BEEP
	beep -l 375 -f 392 -n -l 750 -f 523 -n -l 463 -f 392 -n -l 187 -f 440 -n -l 750 -f 494 -n -l 375 -f 330 -n -l 375 -f 330 -n -l 750 -f 440 -n -l 463 -f 392 -n -l 187 -f 349 -n -l 750 -f 392 -n -l 463 -f 262 -n -l 187 -f 262 -n -l 750 -f 294 -n -l 463 -f 294 -n -l 187 -f 330 -n -l 750 -f 349 -n -l 463 -f 349 -n -l 187 -f 392 -n -l 750 -f 440 -n -l 375 -f 494 -n -l 375 -f 523 -n -l 1125 -f 587
else
	echo ""
fi
sleep 3
#######################################################################
#######################################################################
#######################################################################


#######################################################################
####### Deactivate the screen blanking prevention
#######################################################################
#xset s on
#xset +dpms
#xset s blank
#######################################################################


#######################################################################
######## Shutdown the system
#######################################################################
# Shutdown the system with sudo privileges and delay
if [[ "$confirm" != "y" ]]; then
    # Wait for user input for $wait_time minutes
    read -t $(($wait_time * 60)) -n 2 -s -r -p "Press any key to cancel shutdown or wait $wait_time minute to shutdown..." response

    # Check if user confirmed shutdown or no input was given within $wait_time minutes
    if [[ $response != "" ]]; then
        echo "Shutdown cancelled."
    else
        echo "Shutting down the system in 30 seconds..."
        sleep 30
        sudo shutdown now
    fi

else
    echo "Enjoy results"
fi
#######################################################################
#######################################################################
#######################################################################


#######################################################################
##############################*END*####################################
#######################################################################

cat << echo
$(echo -e "\033[1;37m
                    ..**.*.
                  .*o*.....
                 .**...   ..
                .*.       .
                 **      ..
                 .*.   ...
                  ....**.
                   ...
                  ..
   .......       ...
 .**o**.*......................
 .*****..**........****...*******
 .**********......*..***..***....
 .***.****......***..*..*****....
 .***.**o***...***.***..***o**...
  **o*.*0o*...***.**....***......
  .***..*...**..*.*......oo**....
  .****....*.....*. ..*****.....
   ..***.*..****............**..
   ....********...........***...
   .......*.... .......***...... \033[0m")
echo
echo -e "\e[31m    fifi Howls from happiness\e[0m"

################################*######################################
###############################*H*#####################################
##############################*END*####################################
#############################**END**###################################
############################***END***##################################
###########################****END****#################################
############################***END***##################################
#############################**END**###################################
##############################*END*####################################
##############################*END*####################################
##############################*END*####################################
##############################*END*####################################
##############################*END*#################☭##################
##############################*END*####################################
##############################*END*####################################
##############################*END*####################################
##############################*DEO*####################################
